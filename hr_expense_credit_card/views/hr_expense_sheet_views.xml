<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista formulario de hr.expense.sheet -->
    <record id="hr_expense_sheet_view_form_inherit" model="ir.ui.view">
        <field name="name">hr.expense.sheet.form.credit.card</field>
        <field name="model">hr.expense.sheet</field>
        <field name="inherit_id" ref="hr_expense.view_hr_expense_sheet_form"/>
        <field name="arch" type="xml">
            
            <!-- Agregar botón para ver asientos contables -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button class="oe_stat_button" 
                        name="action_view_account_moves" 
                        type="object" 
                        icon="fa-book"
                        invisible="not account_move_ids">
                    <field name="account_move_ids" invisible="1"/>
                    <div class="o_stat_info">
                        <span class="o_stat_value">
                            <field name="account_move_ids" widget="statinfo" nolabel="1"/>
                        </span>
                        <span class="o_stat_text">Asientos</span>
                    </div>
                </button>
            </xpath>
            
            <!-- Hacer visible el employee_journal_id cuando payment_mode es credit_card -->
            <xpath expr="//field[@name='employee_journal_id']" position="attributes">
                <attribute name="invisible">payment_mode not in ['own_account', 'credit_card']</attribute>
            </xpath>
            
            <!-- Agregar el campo de tarjeta de crédito después del payment_method_line_id -->
            <xpath expr="//field[@name='payment_method_line_id']" position="after">
                <field name="credit_card_id" 
                       invisible="payment_mode != 'credit_card'"
                       required="payment_mode == 'credit_card'"
                       placeholder="Seleccione la tarjeta de crédito"
                       options="{'no_create': True, 'no_create_edit': True}"
                       context="{'default_company_id': company_id}"/>
                <field name="credit_card_partner_id" 
                       invisible="not documento_soporte"/>
                <field name="documento_soporte"/>                       
            </xpath>
        </field>
    </record>

    <!-- Vista tree de hr.expense.sheet -->
    <record id="hr_expense_sheet_view_tree_inherit" model="ir.ui.view">
        <field name="name">hr.expense.sheet.tree.credit.card</field>
        <field name="model">hr.expense.sheet</field>
        <field name="inherit_id" ref="hr_expense.view_hr_expense_sheet_tree"/>
        <field name="arch" type="xml">
            <!-- Agregar el campo de tarjeta en el árbol -->
            <xpath expr="//field[@name='payment_mode']" position="after">
                <field name="credit_card_id" optional="hide"/>
            </xpath>
        </field>
    </record>
</odoo>
