<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="survey_page_print" model="ir.ui.view">
        <field name="name">Survey answers for print</field>
        <field name="inherit_id" ref="survey.survey_page_print" />
        <field name="mode">primary</field>
        <field name="priority">999</field>
        <field name="arch" type="xml">
            <xpath expr="//t[@t-call='survey.layout']" position="attributes">
                <attribute name="t-call">web.layout</attribute>
            </xpath>
            <xpath expr="//t[@t-if='answer.test_entry']" position="attributes">
                <attribute name="t-if">False</attribute>
            </xpath>
            <xpath expr="//t[@t-call='survey.question_text_box']" position="replace">
                <t
                    t-if="question.question_type == 'text_box'"
                    t-call="survey.question_text_box"
                />
            </xpath>
            <xpath expr="//t[@t-call='survey.question_text_box']" position="replace">
                <t
                    t-if="question.question_type == 'text_box'"
                    t-call="survey.question_text_box"
                />
            </xpath>
            <xpath expr="//t[@t-call='survey.question_char_box']" position="replace">
                <t
                    t-if="question.question_type == 'char_box'"
                    t-call="survey_result_mail.question_char_box"
                />
            </xpath>
            <xpath
                expr="//t[@t-call='survey.question_numerical_box']"
                position="replace"
            >
                <t
                    t-if="question.question_type == 'numerical_box'"
                    t-call="survey_result_mail.question_numerical_box"
                />
            </xpath>
            <xpath
                expr="//t[@t-call='survey.question_numerical_box']"
                position="replace"
            >
                <t
                    t-if="question.question_type == 'numerical_box'"
                    t-call="survey_result_mail.question_numerical_box"
                />
            </xpath>
            <xpath
                expr="//t[@t-call='survey.question_numerical_box']"
                position="replace"
            >
                <t
                    t-if="question.question_type == 'numerical_box'"
                    t-call="survey_result_mail.question_numerical_box"
                />
            </xpath>
            <xpath expr="//t[@t-call='survey.question_date']" position="attributes">
                <attribute name="t-call">survey_result_mail.question_date</attribute>
            </xpath>
            <xpath expr="//t[@t-call='survey.question_datetime']" position="attributes">
                <attribute
                    name="t-call"
                >survey_result_mail.question_datetime</attribute>
            </xpath>
            <xpath
                expr="//t[@t-call='survey.question_simple_choice']"
                position="replace"
            >
                <t
                    t-if="question.question_type == 'simple_choice'"
                    t-call="survey_result_mail.question_simple_choice"
                />
            </xpath>
            <xpath
                expr="//t[@t-call='survey.question_multiple_choice']"
                position="replace"
            >
                <t
                    t-if="question.question_type == 'multiple_choice'"
                    t-call="survey_result_mail.question_multiple_choice"
                />
            </xpath>
            <xpath expr="//t[@t-call='survey.question_matrix']" position="replace">
                <t
                    t-if="question.question_type == 'matrix'"
                    t-call="survey_result_mail.question_matrix"
                />
            </xpath>
        </field>
    </record>

    <template id="question_text_box" name="Question: free text box">
        <div class="o_survey_comment_container border">
            <span t-out="answer_lines[0].value_text_box if answer_lines else None" />
        </div>
    </template>

    <template id="question_char_box">
        <div class="o_survey_comment_container border">
            <span t-out="answer_lines[0].value_char_box if answer_lines else None" />
        </div>
    </template>

    <template id="question_numerical_box" name="Question: numerical box">
        <div class="o_survey_comment_container border">
            <span
                t-out="answer_lines[0].value_numerical_box if answer_lines else None"
            />
        </div>
    </template>

    <template id="question_date" name="Question: date box">
        <div class="o_survey_comment_container border">
            <span
                t-out="format_date(answer_lines[0].value_date) if answer_lines else None"
            />
        </div>
    </template>

    <template id="question_datetime" name="Question: datetime box">
        <div class="o_survey_comment_container border">
            <span
                t-out="format_datetime(answer_lines[0].value_datetime) if answer_lines else None"
            />
        </div>
    </template>

    <template id="question_simple_choice" name="Question: simple choice">
        <t
            t-set="answer_line"
            t-value="answer_lines.filtered(lambda line: line.suggested_answer_id)"
        />
        <t
            t-set="comment_line"
            t-value="answer_lines.filtered(lambda line: line.value_char_box)"
        />
        <div
            class="row o_survey_form_choice"
            t-att-data-name="question.id"
            data-question-type="simple_choice_radio"
        >
            <t t-set="item_idx" t-value="0" />
            <div t-attf-class="col-lg-12 d-flex flex-wrap">
                <t
                    t-set="has_correct_answer"
                    t-value="scoring_display_correction and any(label.is_correct for label in question.suggested_answer_ids)"
                />
                <t t-foreach='question.suggested_answer_ids' t-as='label'>
                    <t t-set="item_idx" t-value="label_index" />
                    <t
                        t-set="answer_selected"
                        t-value="answer_line and answer_line.suggested_answer_id.id == label.id"
                    />
                    <t t-set="is_correct" t-value="label.answer_score > 0.0" />
                    <t
                        t-set="answer_class"
                        t-if="not has_correct_answer"
                        t-value="''"
                    />
                    <t
                        t-set="answer_class"
                        t-elif="is_correct"
                        t-value="'bg-success'"
                    />
                    <t
                        t-set="answer_class"
                        t-elif="not is_correct"
                        t-value="'bg-danger'"
                    />

                    <label
                        t-att-for="str(question.id) + '_' + str(label.id)"
                        t-att-class="'o_survey_choice_btn me-2 mb-2 py-1 px-3 rounded %s %s' % (answer_class, 'o_survey_selected' if answer_selected else '')"
                    >

                        <span class="ms-2">
                        <t
                                t-if="answer_line and answer_line.suggested_answer_id.id == label.id"
                            >
                            <i
                                    class="ms-2 fa fa-check-circle float-end mt-1 position-relative"
                                />
                        </t>
                        <t t-else="">
                            <i
                                    class="ms-2 fa fa-circle-thin float-end mt-1 position-relative"
                                />
                        </t>
                        <t t-out="label.value" />
                        </span>
                    </label>
                </t>
            </div>
        </div>
        <div class="row">
            <div
                t-if='question.comments_allowed and question.comment_count_as_answer'
                class="js_comments col-lg-12"
            >
                <div class="d-flex flex-wrap">
                    <label
                        t-att-class="'o_survey_choice_btn me-2 py-1 px-3 rounded %s' % ('o_survey_selected' if comment_line else '')"
                    >
                        <t t-set="item_idx" t-value="item_idx + 1" />
                        <t t-if="comment_line">
                            <i
                                class="ms-2 fa fa-check-circle float-end mt-1 position-relative"
                            />
                        </t>
                        <t t-else="">
                            <i
                                class="ms-2 fa fa-circle-thin float-end mt-1 position-relative"
                            />
                        </t>
                        <span class="ms-2" t-field="question.comments_message" />
                    </label>
                </div>
                <div
                    t-attf-class="o_survey_comment_container mt-3 p-3 px-1 border #{'d-none' if not comment_line else ''}"
                >
                    <span t-out="comment_line.value_char_box if comment_line else ''" />
                </div>
            </div>
            <div
                t-if='question.comments_allowed and not question.comment_count_as_answer'
                class="col-lg-12 o_survey_comment_container mx-1 mt-3 ps-3 pe-4"
            >
                <span t-out="comment_line.value_char_box if comment_line else ''" />
            </div>
        </div>
    </template>

    <template id="question_multiple_choice" name="Question: multiple choice">
        <t
            t-set="comment_line"
            t-value="answer_lines.filtered(lambda line: line.value_char_box)"
        />
        <div
            class="row o_survey_form_choice o_survey_question_multiple_choice"
            t-att-data-name="question.id"
            t-att-data-question-type="question.question_type"
        >
            <t t-set="item_idx" t-value="0" />
            <div class="d-flex flex-wrap col-lg-12">
                <t
                    t-set="has_correct_answer"
                    t-value="scoring_display_correction and any(label.is_correct for label in question.suggested_answer_ids)"
                />
                <t t-foreach='question.suggested_answer_ids' t-as='label'>
                    <t t-set="item_idx" t-value="label_index" />
                    <t
                        t-set="answer_line"
                        t-value="answer_lines.filtered(lambda line: line.suggested_answer_id == label)"
                    />
                    <t
                        t-set="answer_selected"
                        t-value="answer_line and answer_line.suggested_answer_id.id == label.id"
                    />
                    <t t-set="is_correct" t-value="label.answer_score > 0.0" />
                    <t
                        t-set="answer_class"
                        t-if="not has_correct_answer"
                        t-value="''"
                    />
                    <t
                        t-set="answer_class"
                        t-elif="is_correct"
                        t-value="'bg-success'"
                    />
                    <t
                        t-set="answer_class"
                        t-elif="not is_correct"
                        t-value="'bg-danger'"
                    />
                    <label
                        t-att-class="'o_survey_choice_btn me-2 py-1 px-3 rounded %s %s' % (answer_class, 'o_survey_selected' if answer_line else '')"
                    >
                        <span class="ms-2">
                            <t t-if="answer_line">
                                <i
                                    class="ms-2 fa fa-check-square float-end mt-1 position-relative"
                                />
                            </t>
                            <t t-else="">
                                <i
                                    class="ms-2 fa fa-square-o float-end mt-1 position-relative"
                                />
                            </t>
                            <t t-out="label.value" />
                        </span>
                    </label>
                </t>
            </div>
        </div>
        <div class="row">
            <div
                t-if='question.comments_allowed and question.comment_count_as_answer'
                class="js_ck_comments col-lg-12"
            >
                <div class="d-flex flex-wrap">
                    <label
                        t-att-class="'o_survey_choice_btn me-2 py-1 px-3 rounded %s' % ('o_survey_selected' if comment_line else '')"
                    >
                        <t t-set="item_idx" t-value="item_idx + 1" />
                        <span class="ms-2" t-field="question.comments_message" />
                        <t t-if="comment_line">
                            <i
                                class="ms-2 fa fa-check-square float-end mt-1 position-relative"
                            />&#160;
                        </t>
                        <t t-else="">
                            <i
                                class="ms-2 fa fa-square-o float-end mt-1 position-relative"
                            />&#160;
                        </t>
                    </label>
                </div>
                <div
                    t-attf-class="o_survey_comment_container mt-3 p-3 border #{'d-none' if not comment_line else ''}"
                >
                    <span t-out="comment_line.value_char_box if comment_line else ''" />
                </div>
            </div>
        </div>
        <div
            t-if='question.comments_allowed and not question.comment_count_as_answer'
            class="col-lg-12 o_survey_comment_container mx-1 mt-3 p-3 border"
        >
            <span t-out="comment_line.value_char_box if comment_line else ''" />
        </div>
    </template>

    <template id="question_matrix" name="Question: matrix">
        <t
            t-set="comment_line"
            t-value="answer_lines.filtered(lambda line: line.value_char_box)"
        />
        <table
            class="table table-hover o_survey_question_matrix text-center mb-0"
            t-att-data-name="question.id"
            t-att-data-question-type="question.question_type"
            t-att-data-sub-questions="question.matrix_row_ids.ids"
        >
            <thead>
                <tr>
                    <th class="border-0"> </th>
                    <th
                        class="border-0 font-weight-normal"
                        t-foreach="question.suggested_answer_ids"
                        t-as="col_label"
                    ><span t-field="col_label.value" /></th>
                </tr>
            </thead>
            <tbody>
                <t t-set="item_idx" t-value="0" />
                <tr
                    t-foreach="question.matrix_row_ids"
                    t-as="row_label"
                    t-att-id="row_label.id"
                >
                    <th class="border-0 font-weight-normal text-start"><span
                            t-field="row_label.value"
                        /></th>
                    <t t-foreach="question.suggested_answer_ids" t-as="col_label">
                        <t
                            t-set="answer"
                            t-value="answer_lines.filtered(lambda line: line.suggested_answer_id == col_label and line.matrix_row_id == row_label)"
                        />
                        <td
                            t-att-class="'o_survey_matrix_btn text-primary border-0 position-relative %s'
                        % ('o_survey_selected' if answer else '')"
                        >
                            <t t-if="answer">
                                <i
                                    t-att-class="'fa fa-%s position-relative'
                                % ('check-square' if question.matrix_subtype == 'multiple' else 'check-circle')"
                                />
                            </t>
                            <t t-else="">
                                <i
                                    t-att-class="'o_survey_matrix_empty_checkbox fa fa-%s position-relative'
                                % ('square-o' if question.matrix_subtype == 'multiple' else 'circle-thin')"
                                />
                            </t>
                            <t t-set="item_idx" t-value="item_idx + 1" />
                        </td>
                    </t>
                </tr>
            </tbody>
        </table>
        <div t-if='question.comments_allowed'>
            <span
                class="form-control o_survey_question_text_box o_survey_comment bg-transparent text-dark rounded-0 p-0 mt-3"
                t-out="comment_line.value_char_box if comment_line else ''"
            />
        </div>
    </template>

</odoo>
