<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="survey_survey_rule" model="ir.rule">
        <field name="name">Survey by Company</field>
        <field name="model_id" ref="model_survey_survey"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
    </record>
    <record id="survey_question_rule" model="ir.rule">
        <field name="name">Survey Question by Company</field>
        <field name="model_id" ref="model_survey_question"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
    </record>
    <record id="survey_user_input_rule" model="ir.rule">
        <field name="name">Survey User Input by Company</field>
        <field name="model_id" ref="model_survey_user_input"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
    </record>

    <record id="survey_question_answer_rule" model="ir.rule">
        <field name="name">Survey Question Answer by Company</field>
        <field name="model_id" ref="model_survey_question_answer"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
    </record>
    <record id="survey_user_input_line_rule" model="ir.rule">
        <field name="name">Survey User Input Line by Company</field>
        <field name="model_id" ref="model_survey_user_input_line"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
    </record>

    <!-- Inherit and modify survey form view -->
    <record id="survey_inherit_form" model="ir.ui.view">
        <field name="name">survey.survey.inherit.form</field>
        <field name="model">survey.survey</field>
        <field name="inherit_id" ref="survey.survey_survey_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="company_id"/>
            </xpath>
            <xpath expr="//group[@name='options']/group[last()]" position="inside">
                <field name="qrcode" widget="image"/>
            </xpath>
        </field>
    </record>

    <!-- Inherit and modify survey kanban view -->
    <record id="survey_inherit_kanban" model="ir.ui.view">
        <field name="name">survey.survey.inherit.kanban</field>
        <field name="model">survey.survey</field>
        <field name="inherit_id" ref="survey.survey_survey_view_kanban"/>
        <field name="arch" type="xml">
            <field name="success_ratio" position="after">
                <field name="create_uid"/>
                <field name="answer_score_avg"/>
            </field>
            <xpath expr="//div[@class='container o_kanban_card_content']" position="inside">
                <div class="row mt-4 ml-5">
                    <div class="col-4 p-0" t-if="record.scoring_type.raw_value != 'no_scoring'">
                        <a name="action_survey_user_input_completed" type="object" class="d-flex flex-column align-items-center">
                            <span class="font-weight-bold"> <field name="create_uid"/></span>
                            <span class="text-muted">Created by</span>
                        </a>
                    </div>
                    <div class="col-4 p-0 border-left" t-if="record.scoring_type.raw_value != 'no_scoring'">
                        <a name="action_survey_user_input_completed" type="object" class="d-flex flex-column align-items-center">
                            <span class="font-weight-bold"> <t t-esc="Math.round(record.answer_score_avg.raw_value)"/> %</span>
                            <span class="text-muted">Average Score</span>
                        </a>
                    </div>
                </div>
            </xpath>
        </field>
    </record>
</odoo>
